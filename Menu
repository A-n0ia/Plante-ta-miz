#include "paramitz.h"

void clearConsole() {
#ifdef _WIN32
    system("cls");   // Windows
#else
    system("clear"); // Linux / Mac
#endif
}

void attendreTouche(){
    printf("\nAppuyer sur la touche ENTREE pour continuer....");
    getchar();
}

/*void afficherTitreJeu() {
    printf("\033[1;33m"); // couleur jaune
    printf("===================================\n");
    printf(" _   _  _____  _     _     ____   \n");
    printf("| | | || ____|| |   | |   /  _ \\ \n");
    printf("| |_| ||  _|  | |   | |   | | | |  \n");
    printf("|  _  || |___ | |___| |___| |_| |\n");
    printf("|_| |_||_____||_____|_____\\____/  \n");
    printf("===================================\n");
    printf("\n   BIENVENUE SUR PLANTAMITZ! \n");
    printf("===================================\n");
    printf("\033[0m"); // couleur normale
}*/

void afficherTitreJeu() {
    printf("\033[1;33m"); // couleur jaune

    int marge = 43; // Nombre d'espaces à gauche pour centrer le texte
    for (int i = 0; i < marge; i++) printf(" "); printf("===================================\n");
    for (int i = 0; i < marge; i++) printf(" "); printf(" _   _  _____  _     _     ____   \n");
    for (int i = 0; i < marge; i++) printf(" "); printf("| | | || ____|| |   | |   /  _ \\ \n");
    for (int i = 0; i < marge; i++) printf(" "); printf("| |_| ||  _|  | |   | |   | | | |  \n");
    for (int i = 0; i < marge; i++) printf(" "); printf("|  _  || |___ | |___| |___| |_| |\n");
    for (int i = 0; i < marge; i++) printf(" "); printf("|_| |_||_____||_____|_____\\____/  \n");
    for (int i = 0; i < marge; i++) printf(" "); printf("===================================\n\n");

    for (int i = 0; i < marge + 6; i++) printf(" "); // petit décalage en plus pour centrer le sous-titre
    printf("BIENVENUE SUR PLANTAMITZ !\n");

    for (int i = 0; i < marge; i++) printf(" "); printf("===================================\n");
    printf("\033[0m"); // couleur normale
}


void afficherMenuTitre() {
    printf("\033[1;33m"); // couleur jaune
    int marge = 43; // Nombre d'espaces à gauche pour centrer le texte

    for (int i = 0; i < marge; i++) printf(" ");printf("==============================\n");
    for (int i = 0; i < marge; i++) printf(" ");printf(" __  __  _____ _    _   _   _   \n");
    for (int i = 0; i < marge; i++) printf(" ");printf("|  \\/  || ____| \\ || | | | | \n");
    for (int i = 0; i < marge; i++) printf(" ");printf("| |\\/| ||  _| |  \\|| | | | |  \n");
    for (int i = 0; i < marge; i++) printf(" ");printf("| |  | || |___| |\\  | | |_| |  \n");
    for (int i = 0; i < marge; i++) printf(" ");printf("|_|  |_||_____|_| \\_| \\___//   \n");
    for (int i = 0; i < marge; i++) printf(" ");printf("==============================\n");
    for (int i = 0; i < marge; i++) printf(" ");printf("\033[0m"); // reset couleur
}

void afficherMenuPrincipal(){
    //printf("=== BIENVENUE SUR PLANTAMITZ ! ===\n");
    int marge =43;
    printf("1. Nouvelle partie\n");
    for (int i = 0; i < marge; i++) printf(" ");printf("2. Reprendre la partie\n");
    for (int i = 0; i < marge; i++) printf(" ");printf("3. Regles du jeu\n");
    for (int i = 0; i < marge; i++) printf(" ");printf("0. Quitter\n");
}

int lireChoixMenu(){
    int marge=43;
    int choix;
    int resultatScan;
    for (int i = 0; i < marge; i++) printf(" ");printf("CHOIX :");
    do{
        resultatScan=scanf("%d",&choix);
        if(resultatScan !=1){
            //Si l'utilisateur n'a pas tapé un nombre
            printf("Entree invalide ! Veuillez saisir un nombre :");
            while(getchar()!='\n');
        }else{
             if(choix<0 || choix>3){
                printf("Entree invalide ! Veuillez faire un choix valide :");
            }
        }
    }while(resultatScan!=1 || choix<0 || choix>3);
    return choix;
}

void ReglesComplet(){
    printf("\033[1;36m=== REGLES DU JEU ===\033[0m\n\n"); // cyan

    printf("\n- OBJECTIF -\n");
    printf("Alignez des items identiques pour remplir le contrat.\n\n");
    attendreTouche();

    printf("\n- ITEMS -\n");
    printf("  S : Soleil\n");
    printf("  F : Fraise\n");
    printf("  P : Pomme\n");
    printf("  O : Oignon\n");
    printf("  M : Mandarine\n\n");
    attendreTouche();

    printf("\n- COMMANDES -\n");
    printf("  Deplacer le curseur : \n");
    printf("    - z (haut)\n");
    printf("    - q (gauche)\n");
    printf("    - s (bas)\n");
    printf("    - d (droite)\n");
    printf("    - FLECHES POSSIBLE \n");
    printf("  Selectionner un item : barre d'espace\n");
    printf("  Permuter avec un item adjacent apres selection \n\n");
    attendreTouche();

    printf("\n- REGLES DE SUPPRESSION ET POINTS -\n");
    printf("  Groupe de 3 ou plus : disparition\n");
    printf("  Groupe de 4 : 4 points\n");
    printf("  Groupe en H : 2*X points (X = nb items)\n");
    printf("  Rectangle L x l : 2*(L*l) points\n");
    printf("  Groupe de 6 : disparition de tous les items identiques\n\n");
    attendreTouche();

    printf("\n- FIN DE PARTIE -\n");
    printf("  5 vies max\n");
    printf("  Sauvegarde du joueur et niveaux\n");
    printf("  Recommencer ou quitter\n\n");
    attendreTouche();

    printf("\n=== FIN DES RÈGLES ===\n");

}

void regleObjectif() {
    printf("\n=== OBJECTIF ===\n");
    printf("Alignez des items identiques pour remplir le contrat.\n");
    attendreTouche();
}

void regleItems() {
    printf("\n=== ITEMS et COULEURS ===\n");
    printf("S : Soleil (jaune)\n");
    printf("F : Fraise (rouge)\n");
    printf("P : Pomme (vert)\n");
    printf("O : Oignon (violet)\n");
    printf("M : Mandarine (orange)\n");
    attendreTouche();
}

void regleCommandes() {
    printf("  Deplacer le curseur : \n");
    printf("    - z (haut)\n");
    printf("    - q (gauche)\n");
    printf("    - s (bas)\n");
    printf("    - d (droite)\n");
    printf("    - FLECHES POSSIBLE \n");
    printf("  Selectionner un item : barre d'espace\n");
    printf("  Permuter avec un item adjacent apres selection \n\n");
    attendreTouche();
}

void reglePoints() {
    printf("\n=== POINTS et SUPPRESSION ===\n");
    printf("Groupe de 3+ : disparition\n");
    printf("Groupe de 4 : 4 points\n");
    printf("H : 2*X points (X = nb items)\n");
    printf("Rectangle L x l : 2*(L*l) points\n");
    printf("Groupe de 6 : disparition de tous les items identiques\n");
    attendreTouche();
}

void regleFinPartie() {
    printf("\n=== FIN DE PARTIE ===\n");
    printf("5 vies max, sauvegarde du joueur, possibilité de recommencer ou quitter\n");
    attendreTouche();
}

void menuRegles(){
    int choix;
    do{
        printf("\n=== REGLES DU JEU ===\n");
        printf("1. Regles completes\n");
        printf("2. Objectif\n");
        printf("3. Items et couleurs\n");
        printf("4. Commandes\n");
        printf("5. Points et suppression\n");
        printf("6. Fin de partie\n");
        printf("0. Retour au menu principal\n");
        printf("CHOIX : ");

        scanf("%d",&choix);
        while(getchar() != '\n');
        switch(choix){
            case 1 :
                clearConsole();
                ReglesComplet();
                clearConsole();
                break;
            case 2 :
                clearConsole();
                regleObjectif();
                clearConsole();
                break;
            case 3 :
                clearConsole();
                regleItems();
                clearConsole();
                break;
            case 4 :
                clearConsole();
                regleCommandes();
                clearConsole();
                break;
            case 5 :
                clearConsole();
                reglePoints();
                clearConsole();
                break;
            case 6 :
                clearConsole();
                regleFinPartie();
                clearConsole();
                break;
            case 0 :
                clearConsole();
                printf("Retour au menu principal...\n");
                break;
            default:
                clearConsole();
                printf("Choix invalide !\n");
        }
    }while(choix!=0);
}

void menuPrincipal(){
    int choix;
    do{
        clearConsole();
        afficherTitreJeu();
        Sleep(3000);
        clearConsole();
        afficherMenuTitre();
        afficherMenuPrincipal();
        choix=lireChoixMenu();
        switch(choix){
            case 1:
                // sous-programme qui permet de lancer une nouvelle partie
                break;
            case 2:
                // sous-programme qui permet de reprendre une partie
                break;
            case 3:
                // sous-programme qui affiche les règles du jeu
                clearConsole();
                menuRegles();
                break;
            case 0 :
                printf("AU REVOIR !\n");
                break;
        }
    }while(choix!=0);
}
